<!DOCTYPE html>
<html>
<head>
    <title>Communication Aid</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
    
    <style>
      /* Styling for clear visibility and centered layout */
      body {
          font-family: Arial, sans-serif;
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-top: 20px;
      }
      #webcam-container {
        width: 300px; /* Matches forced camera width */
        height: 200px; /* Matches forced camera height */
        border: 4px solid #00A9E0; 
        margin: 10px auto;
      }
      #label-container {
        font-size: 32px; /* Large font for low-vision/easy reading */
        font-weight: bold;
        text-align: center;
        color: #CC0000; /* High contrast red */
        margin-top: 15px;
      }
    </style>
</head>
<body>
    
    <div id="webcam-container"></div>
    <div id="label-container">LOADING MACHINE LEARNING MODEL...</div>
    
    <script type="text/javascript">
        // --- MODEL CONFIGURATION ---
        const URL = "https://teachablemachine.withgoogle.com/models/qLMkiB_Zn/"; 
        const COMMUNICATION_MESSAGE = "I need help, please!";
        const CONFIDENCE_THRESHOLD = 0.80; 

        let model, webcam, labelContainer, maxPredictions;
        let messageSpoken = false; 

        // Function to speak the message using the standard browser API
        function speakMessage() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(COMMUNICATION_MESSAGE);
                window.speechSynthesis.speak(utterance);
            }
        }

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            
            try {
                // 1. Load Model (Requesting compressed 'uint8' to solve loading stalls)
                model = await tmPose.load(modelURL, metadataURL, { quantization: 'uint8' });
                maxPredictions = model.getTotalClasses();

                // Setup the webcam object (size is for the canvas, not the stream)
                const size = 300; 
                const flip = true;
                webcam = new tmPose.Webcam(size, size, flip);

                // 2. CRITICAL FIX: Force low resolution for Chromebook compatibility
                await webcam.setup({ facingMode: "user", width: 300, height: 200 }); 
                await webcam.play();
                window.requestAnimationFrame(
